{% extends "blog/rp/rp_header.html" %}
{% block content %}
{% load staticfiles %}

<title>Machine Learning and Finance</title>
<head>
  <script type="text/javascript" src="http://latex.codecogs.com/latexit.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>
<h1>Machine Learning and Finance</h1>
<h3>
    <span style="color: #D5518D" id="author">By </span>
    <span style="color: #3E95D7" id="name">Aadiraj Batlaw</span>
  </h3>

<div class=Blog_Nav>
  <ol>
     <!-- FILL IN SECTIONS -->
    <li><a href="#Section1">Introduction</a></li>
    <li><a href="#Section2">Data Analysis</a></li>
    <li><a href="#Section3">Visualizations</a></li>
    <li><a href="#Section4">Conclusion</a></li>
    <li><a href="#Section5">Citation</a></li>
  </ol>
</div>
<br>

<div id="Section1">
  <h3>Introduction</h3>
    <p>
      For my project for the Research and Publications committee of SUSA, I decided to try my hand in utilizing machine learning models to predict stock success. I chose this project topic for two primary reasons. First, I wanted to further my current analysis of financial markets. For the past four years, I have been conducting a virtual million dollar portfolio, in which I evaluate	 companies based on characteristics such as disruptive potential, moats, use of technology, and leadership ability. Although this method of analysis proved to be quite effective (with current all time return at 98.9%),  I wanted to see if I could incorporate a more technical approach to my analysis.
    </p>
    <p>
      The second reason is that I wanted to gain some skills I may be able to utilize as I make my transition from a pupil to an agent of the professional world. As a Statistics and Economics double major, I believe the world of financial analysis (which readily hires from both fields) may be a high potential outlook for me. Wishing to ready myself for such a career, I wanted to pursue a project most suited with this field of work. As the applications of machine learning are becoming more and more utilized in these fields, I felt it was about time I at least took my first step in the category of data analytics.
    </p>
    <p>
      In this project, I will be joining multiple datasets to construct one that will allow me to predict stock success from a selected group of financial statistics that have been deemed fortuitous predictors. These statistics include "Net Cash Flow", "Cost of Revenue", "Earnings Before Interest and Tax", "Gross Profit", "Investments","Long-Term Debt","Total Revenue". I conducted my analysis in python, using the pandas package. My final goal was to correlate and predict the “5 Year Return” of a given stock.
    </p>
</div>

<div id="Section2">
  <h3>Data Analysis</h3>
    <p>
      My first task of the project was cleaning and organizing my data. I began with a Kaggle dataset called “Fundamentals” from the New York Stock Exchange (Gawlik). This dataset consisted of 72 stock financials, of which I chose the 9 ones I has researched to be the most important, including the ticker symbol and the time the financials were collected. But this was not enough. I wanted to predict relatively long term success (5 years, in this case). But my current dataset was only offering me at most a 3 year range, with inconsistent dates for many of the stocks. In addition, my dataset did not include the price of the stock, which is essential to predicting it’s growth. So I looked for a new dataset, and found another Kaggle dataset called “All Stocks 5 Year”, which gave the price of stock practically every month for the past 5 years (Nugent).
    </p>
    <p>
      Having never properly used pandas before, I found joining the datasets together to be one of the most difficult tasks of this project for me. After much trial and error, I finally decided to change the dates on the first dataset that were roughly close to 2013-02-08 to that date exactly. Then, I merged my second dataset with itself, thereby making it display the price of the stock on 2013-02-08 and then five years later on 2018-01-02. Finally, I merged the two datasets together. After adding a column that calculated the “5 Year Return” of the stock (given as a percentage), I had a final dataset that included all statistics for the stocks taken from a date roughly around 2013-02-08 and the future five year return of that stock.
    </p>
    <p>
      At this point, I was able to move on to the actual machine learning part of this investigation. For this part, I used Sklearn, which is a machine learning library package used for investigations performed in python. The algorithms I used in this project were ordinary least squares regression, ridge regression, lasso regression, multi-task lasso regression, and decision tree regression. Ordinary least squares regression generates a regression model that minimizes the total squared error of your dataset from the model. Ridge regression goes further, combating overfitting by minimizing the “penalized residual sum of squares” (Scikit). In Lasso regression, overfitting is minimized by shrinking your data “towards a central point, like a mean” in a process called “Shrinkage”  (Scikit).  The difference between multi-task lasso regression and regular lasso regression is that multi-task lasso regression “estimates sparse coefficients for multiple regression problems jointly”, analyzing the influence independent variables have together on the predicted model  (Scikit). Finally, in decision tree regression, the model employs “simple decision rules inferred from the data features”, thereby determining the extent of influence of specific variables  (Scikit).
    </p>
    <p>
      A major problem I immediately ran into was how to perform this analysis on multiple variables (i.e. how to perform multivariate regression). From help from Patrick Chan, the head of the education committee of SUSA, I learnt that I had to pass in a dataframe, not a list of columns, if I wanted to conduct such a regression. Patrick also taught me how I should split up my data, selecting 80% of the data to be used as my training data and 20% to be used as my test. In addition to the the multivariate regression analysis I performed using each algorithm, I also performed the same analysis using single-variable regression, allowing me to compare the results of the two. The results of this investigation can be seen in the visuals that follow.
    </p>
</div>

<div id="Section3">
  <h3>Visualizations</h3>
    <!-- This is how you add an image! style="margin:auto" centers the image. -->
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Ordinary Least Squares Regression(One Variable).png' %}" style="margin:auto"></img><br><br>
    <p>
      This graph correlates cash flow with 5 Year Return. As one can see, most of data is concentrated at a cash flow of 0, with a fairly even spread up and down for their 5 year return. From this graph and the 0.01 R^2 term, one can determine there exists no correlation between cash flow and 5 Year Return.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Ordinary Least Squares Regression(Multivariate).png' %}" style="margin:auto"></img><br><br>
    <p>
      This graph correlates all company financials with 5 Year Return. As one can see, most of data is concentrated at company financial values of 0 and a predicted 5 Year Return rate around 75%. The rest of the model extends out inconclusively. Furthermore, the negative R^2 value suggests not only no legitimate correlation exists, but that in fact a straight line would predict 5 Year Return better than the model.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Ridge Regression(One Variable).png' %}" style="margin:auto"></img><br><br>
    <p>
      This graph correlates Cost of Revenue with 5 Year Return. As one can see, most of data is concentrated at a cash flow of 0, with a fairly even spread up and down for their 5 year return. From this graph and the 0.03 R^2 term, one can determine there exists no correlation between cash flow and 5 Year Return.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Ridge Regression (Multivariate).png' %}" style="margin:auto"></img><br><br>
    <p>
      This graph is virtually identical to the multivariate least squares regression model. Therefore the same conclusion of no correlation can be drawn from this model too.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Lasso Regression (One Variable).png' %}" style="margin:auto"></img><br><br>
    <p>
      This model appears to be overfitting to our data. Again, from this graph and our negative R^2 value, we can determine that no correlation exists.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Lasso Regression (Multivariate).png' %}" style="margin:auto"></img><br><br>
    <p>
      Again, identical model and no correlation.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Multi-task Lasso Regression (One Variable).png' %}" style="margin:auto"></img><br><br>
    <p>
      Most of the data in this graph is concentrated at a Cost of Revenue of 0 and a Predicted 5 Year Return of 80%, with the rest of the model extending downwards inconclusively.  The R^2 value is positive, but still very close to 0, suggesting no correlation.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Multi-task Lasso Regression (Multivariate).png' %}" style="margin:auto"></img><br><br>
    <p>
      Again, no correlation.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Decision Tree Regression (One Variable).png' %}" style="margin:auto"></img><br><br>
    <p>
      Here, we also see signs of overfitting to the model, with an even more negative R^2 value, suggesting a highly inaccurate model.
    </p>
    <img src="{% static 'usa_website/images/blog/rp/spring_2019/machinelearning_and_finance/Decision Tree Regression (Multivariate).png' %}" style="margin:auto"></img><br><br>
    <p>
      Similarly, we see an overfitted and a largely ineffective model.
    </p>
</div>

<div id="Section4">
  <h3>Conclusion</h3>
    <p>
	     Unfortunately, from this analysis, we see that we were not able to determine a strong correlations for any of our analyses. In many occasions the    predictions made from our model would have been more accurate if he model had been a flat line. Nonetheless, I would still deem this a valuable experience in learning how to apply simple machine learning algorithms to complex datasets, helping me take my first steps into the world of financial analytics.
    </p>
</div>

<div id="Section5">
  <h3>Citation</h3>
    <p>
      Gawlik, Dominik. “New York Stock Exchange.” Kaggle, 22 Feb. 2017, <a href="www.kaggle.com/dgawlik/nyse">www.kaggle.com/dgawlik/nyse</a>.
    </p>
    <p>
      Nugent, Cam. “S&P 500 Stock Data.” Kaggle, 10 Feb. 2018, <a href="www.kaggle.com/camnugent/sandp500">www.kaggle.com/camnugent/sandp500</a>.
    </p>
    <p>
       “1.1. Generalized Linear Models¶.” Scikit, <a href="scikit-learn.org/stable/modules/linear_model">scikit-learn.org/stable/modules/linear_model.html</a>.
    </p>
    <p>
      “1.10. Decision Trees¶.” Scikit, <a href="scikit-learn.org/stable/modules/tree">scikit-learn.org/stable/modules/tree.html</a>.
    </p>
</div>

{% endblock %}
